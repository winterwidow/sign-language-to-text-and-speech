<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GestureFlow - Live Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Optional: Glitch text effect */
        .glitch-text {
            position: relative;
            color: #0ea5e9;
            font-weight: 900;
        }
    </style>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</head>

<body class="bg-[#0D1117] text-white font-roboto min-h-screen flex flex-col">

    <header class="fixed top-0 left-0 right-0 z-50 py-4 px-8 bg-[rgba(13,17,23,0.8)] backdrop-blur-sm shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="font-orbitron text-2xl font-bold text-sky-400 nav-link-glow">GestureFlow</a>
            <nav>
                <ul class="flex space-x-8">
                    <li><a href="index.html"
                            class="font-orbitron text-lg text-gray-300 hover:text-white nav-link-glow transition-colors duration-300">HOME</a>
                    </li>
                    <li><a href="#"
                            class="font-orbitron text-lg text-gray-300 hover:text-white nav-link-glow transition-colors duration-300">ABOUT
                            US</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow pt-32 px-4 container mx-auto max-w-7xl">
        <div class="text-center mb-12">
            <h1 class="font-orbitron text-6xl md:text-7xl font-bold glitch-text" data-text="LIVE RECOGNITION">LIVE
                RECOGNITION</h1>
            <p class="text-xl text-sky-300 mt-2">Activate your webcam to begin real-time sign language translation.</p>
        </div>
        <div class="flex flex-col md:flex-row gap-8 items-stretch">
            <!-- Video Stream Section -->
            <section class="w-full md:w-1/2">
                <h2 class="font-orbitron text-3xl text-sky-400 mb-4 text-left">INPUT STREAM</h2>
                <div
                    class="relative w-full aspect-video rounded-lg shadow-[0_0_25px_rgba(75,222,128,0.4)] border-2 border-green-400/50 overflow-hidden bg-black">
                    <img id="video-stream" class="w-full h-full object-cover" src="/video_feed" alt="Live video feed" />
                </div>
            </section>

            <!-- Prediction Output Section -->
            <section class="w-full md:w-1/2 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-orbitron text-3xl text-sky-400 text-left">AI OUTPUT LOG</h2>
                    <button id="speak-btn" title="Read Aloud"
                        class="flex items-center gap-x-2 rounded-full py-2 px-4 hover:bg-green-500/20 transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                        </svg>
                        <span class="hidden md:inline font-orbitron text-green-400">Read Aloud</span>
                    </button>
                </div>
                <div id="output-log"
                    class="card w-full flex-grow p-4 rounded-lg border border-gray-700/50 font-mono text-lg text-green-300 overflow-y-auto min-h-[150px] flex items-center justify-center">
                    <p class="text-gray-500 text-center">> [Awaiting Signal...]</p>
                </div>

                <div class="mt-4">
                    <h3 class="font-orbitron text-2xl text-sky-400 mb-2">Constructed Phrase</h3>
                    <div id="phrase-display"
                        class="card p-4 rounded-lg border border-gray-700/50 font-mono text-xl text-green-300 min-h-[3rem]">
                    </div>
                    <div class="mt-2 flex gap-4">
                        <button id="btn-clear"
                            class="glow-button bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-full">Clear</button>
                        <button id="btn-delete"
                            class="glow-button bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-6 rounded-full">Delete
                            Last</button>
                        <button id="btn-speak-phrase"
                            class="glow-button bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-full">Speak
                            Phrase</button>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();
            const outputLog = document.getElementById('output-log');
            const speakButton = document.getElementById('speak-btn');

            const phraseDisplay = document.getElementById('phrase-display');
            const btnClear = document.getElementById('btn-clear');
            const btnDelete = document.getElementById('btn-delete');
            const btnSpeakPhrase = document.getElementById('btn-speak-phrase');

            let latestPredictionText = '';
            let phrase = '';

            // Throttle rapid repeats to avoid flooding phrase with same letters quickly
            let lastPredictionTime = 0;
            const predictionDelay = 800; // ms

            socket.on('connect', () => {
                console.log('Connected to GestureFlow AI server');
                outputLog.innerHTML = '<p class="text-green-300 text-center">> [Connected to server]</p>';
            });

            socket.on('prediction', (data) => {
                const now = Date.now();
                if (now - lastPredictionTime < predictionDelay) {
                    // Ignore too-frequent recognitions
                    return;
                }
                lastPredictionTime = now;

                latestPredictionText = data.text;
                const confidencePercent = (data.confidence * 100).toFixed(1);
                outputLog.innerHTML = `<p>> Predicted: <strong>${latestPredictionText}</strong> (Confidence: ${confidencePercent}%)</p>`;

                // Append letter to phrase
                phrase += latestPredictionText;
                phraseDisplay.textContent = phrase;
            });

            socket.on('disconnect', () => {
                console.log('Disconnected from GestureFlow AI server');
                outputLog.innerHTML = '<p class="text-red-500 text-center">> [Disconnected from server]</p>';
            });

            speakButton.addEventListener('click', () => {
                if (!window.speechSynthesis) {
                    alert('Sorry, your browser does not support speech synthesis.');
                    return;
                }
                if (!latestPredictionText || latestPredictionText.trim() === '') {
                    alert('No gesture recognized yet to speak.');
                    return;
                }
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
                const utterance = new SpeechSynthesisUtterance(latestPredictionText);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            });

            // Controls for phrase

            btnClear.addEventListener('click', () => {
                phrase = '';
                phraseDisplay.textContent = '';
            });

            btnDelete.addEventListener('click', () => {
                phrase = phrase.slice(0, -1);
                phraseDisplay.textContent = phrase;
            });

            btnSpeakPhrase.addEventListener('click', () => {
                if (!window.speechSynthesis) {
                    alert('Sorry, your browser does not support speech synthesis.');
                    return;
                }
                if (!phrase || phrase.trim() === '') {
                    alert('No phrase to speak.');
                    return;
                }
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
                const utterance = new SpeechSynthesisUtterance(phrase);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            });
        });

    </script>


</body>

</html>
